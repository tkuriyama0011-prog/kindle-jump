<!doctype html>
<meta charset="utf-8" />
<title>Kindle Jump</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 16px; line-height: 1.5; }
  code { word-break: break-all; }
</style>
<script>
  const p = new URLSearchParams(location.search);
  const asin = p.get("asin");
  const loc  = p.get("loc");

  function showFallback(url) {
    document.body.innerHTML = `
      <h1>Kindleを開いています…</h1>
      <p>自動で開かない場合は、下のリンクをクリックしてください。</p>
      <p><a href="${url}">${url}</a></p>
      <p><small>asin=${asin || ""} / loc=${loc || ""}</small></p>
    `;
  }

  if (!asin || !loc) {
    document.body.textContent = "Missing query params: ?asin=XXXXXXXXXX&loc=123";
  } else {
    const url = `kindle://book?action=open&asin=${encodeURIComponent(asin)}&location=${encodeURIComponent(loc)}`;
    location.href = url;
    setTimeout(() => showFallback(url), 500);
  }
</script>
